<!DOCTYPE html>
<html lang="gu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ડીલ સર્ચ</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; }
    #filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    label { margin-right: 5px; font-weight: bold; }
    select { padding: 5px; }
    #result { margin-top: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; white-space: normal; word-wrap: break-word; }
    th { background-color: #f2f2f2; font-weight: bold; }
    tbody tr:nth-child(even) { background-color: #f9f9f9; }
    .error { color: red; font-size: 18px; }
    @media (max-width: 600px) { #filters { flex-direction: column; } table { font-size: 14px; } }
    @media (min-width: 601px) { #result { overflow-x: auto; } table { min-width: 1000px; } }
  </style>
</head>
<body>
  <div id="filters"></div>
  <div id="result"></div>
  <script>
    const apiUrl = 'https://sheetdb.io/api/v1/2zxgfpd8lb4qo'; // નવી API લિંક
    let data = [];
    const selects = {};
    const headers = ["DEAL CODE", "CAST", "FLET", "HOME", "SHOPE", "RANGE", "LOCATION", "ADDISNAL", "LINK OF DEAL", "PHOTO/VEDIO LINK"];

    fetch(apiUrl, { method: 'GET', mode: 'cors' })
      .then(response => {
        if (!response.ok) throw new Error('APIમાં ભૂલ: ' + response.status + ' - ' + response.statusText);
        return response.json();
      })
      .then(items => {
        if (!items || items.length === 0) {
          document.getElementById('result').innerHTML = '<p class="error">કોઈ ડેટા નથી</p>';
          return;
        }
        data = items;
        console.log('API ડેટા:', data);
        populateFilters();
        filterData();
      })
      .catch(error => {
        console.error('ભૂલ:', error);
        document.getElementById('result').innerHTML = '<p class="error">API કનેક્શનમાં ભૂલ: ' + error.message + '</p>';
      });

    function populateFilters() {
      const filtersContainer = document.getElementById('filters');
      
      const propertyLabel = document.createElement('label'); propertyLabel.textContent = 'પ્રોપર્ટીનો પ્રકાર: ';
      const propertySelect = document.createElement('select'); propertySelect.id = 'select-property';
      ['All', 'HOME', 'FLET', 'SHOPE'].forEach(optionValue => {
        const option = document.createElement('option'); option.value = optionValue; option.textContent = optionValue; propertySelect.appendChild(option);
      });
      propertySelect.onchange = filterData; filtersContainer.appendChild(propertyLabel); filtersContainer.appendChild(propertySelect); selects['property'] = propertySelect;

      const locationLabel = document.createElement('label'); locationLabel.textContent = 'લોકેશન: ';
      const locationSelect = document.createElement('select'); locationSelect.id = 'select-LOCATION';
      const allLocationOption = document.createElement('option'); allLocationOption.value = 'All'; allLocationOption.textContent = 'બધા'; locationSelect.appendChild(allLocationOption);
      const uniqueLocations = [...new Set(data.map(item => item['LOCATION']).filter(v => v && v.trim() !== ''))].sort();
      uniqueLocations.forEach(value => { const option = document.createElement('option'); option.value = value; option.textContent = value; locationSelect.appendChild(option); });
      locationSelect.onchange = filterData; filtersContainer.appendChild(locationLabel); filtersContainer.appendChild(locationSelect); selects['LOCATION'] = locationSelect;

      const rangeLabel = document.createElement('label'); rangeLabel.textContent = 'બજેટ: ';
      const rangeSelect = document.createElement('select'); rangeSelect.id = 'select-RANGE';
      const allRangeOption = document.createElement('option'); allRangeOption.value = 'All'; allRangeOption.textContent = 'બધા'; rangeSelect.appendChild(allRangeOption);
      const uniqueRanges = [...new Set(data.map(item => item['RANGE']).filter(v => v && v.trim() !== ''))].sort();
      uniqueRanges.forEach(value => { const option = document.createElement('option'); option.value = value; option.textContent = value; rangeSelect.appendChild(option); });
      rangeSelect.onchange = filterData; filtersContainer.appendChild(rangeLabel); filtersContainer.appendChild(rangeSelect); selects['RANGE'] = rangeSelect;
    }

    function filterData() {
      let filtered = data;
      const propertySelect = selects['property']; const locationSelect = selects['LOCATION']; const rangeSelect = selects['RANGE'];
      const selectedProperty = propertySelect.value; const selectedLocation = locationSelect.value; const selectedRange = rangeSelect.value;

      if (selectedProperty !== 'All') {
        filtered = filtered.filter(item => item[selectedProperty] && item[selectedProperty].trim() !== '');
      }
      if (selectedLocation !== 'All') {
        filtered = filtered.filter(item => item['LOCATION'] === selectedLocation);
      }
      if (selectedRange !== 'All') {
        filtered = filtered.filter(item => item['RANGE'] === selectedRange);
      }
      displayResults(filtered);
    }

    function displayResults(deals) {
      const result = document.getElementById('result'); result.innerHTML = '';
      if (deals.length === 0) {
        result.textContent = 'કોઈ ડીલ મળી નહીં';
        return;
      }
      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      headers.forEach(header => {
        const th = document.createElement('th'); th.textContent = header; headerRow.appendChild(th);
      });
      thead.appendChild(headerRow); table.appendChild(thead);

      const tbody = document.createElement('tbody');
      deals.forEach(deal => {
        const row = document.createElement('tr');
        headers.forEach(header => {
          const td = document.createElement('td'); td.textContent = deal[header] || 'N/A'; row.appendChild(td);
        });
        tbody.appendChild(row);
      });
      table.appendChild(tbody); result.appendChild(table);
    }
  </script>
</body>
</html>