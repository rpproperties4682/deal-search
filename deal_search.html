<!DOCTYPE html>
<html lang="gu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ડીલ સર્ચ</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; }
    #filters { display: flex; flex-wrap: wrap; gap: 10px; }
    label { margin-right: 5px; }
    select { padding: 5px; }
    #result { margin-top: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; white-space: normal; word-wrap: break-word; }
    th { background-color: #f2f2f2; font-weight: bold; }
    tbody tr:nth-child(even) { background-color: #f9f9f9; }
    .error { color: red; }
    @media (max-width: 600px) {
      table { display: none; }
      .deal-card { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; background: #f9f9f9; }
      .deal-card p { margin: 5px 0; }
    }
    @media (min-width: 601px) {
      #result { overflow-x: auto; }
      table { min-width: 1000px; }
    }
  </style>
</head>
<body>
  <div id="filters"></div>
  <div id="result"></div>
  <script>
    const apiUrl = https://sheetdb.io/api/v1/z0yawz4vjuymz'; // તમારી API લિંક
    let data = [];
    const selects = {};
    const headers = ["DEAL CODE", "CAST", "FLET", "HOME", "SHOPE", "RANGE", "LOCATION", "ADDISNAL", "LINK OF DEAL", "PHOTO/VEDIO LINK"];

    fetch(apiUrl)
      .then(response => {
        if (!response.ok) throw new Error('APIમાં ભૂલ: ' + response.status);
        return response.json();
      })
      .then(items => {
        if (!items || items.length === 0) {
          document.getElementById('result').innerHTML = '<p class="error">કોઈ ડેટા નથી</p>';
          return;
        }
        data = items;
        populateFilters();
        filterData();
      })
      .catch(error => {
        console.error('ભૂલ:', error);
        document.getElementById('result').innerHTML = '<p class="error">API કનેક્શનમાં ભૂલ: ' + error.message + '</p>';
      });

    function populateFilters() {
      const filtersContainer = document.getElementById('filters');
      const propertyLabel = document.createElement('label'); propertyLabel.textContent = 'પ્રોપર્ટીનો પ્રકાર: ';
      const propertySelect = document.createElement('select'); propertySelect.id = 'select-property';
      ['All', 'HOME', 'FLET', 'SHOPE'].forEach(optionValue => {
        const option = document.createElement('option'); option.value = optionValue; option.textContent = optionValue; propertySelect.appendChild(option);
      });
      propertySelect.onchange = updateDealOptions; filtersContainer.appendChild(propertyLabel); filtersContainer.appendChild(propertySelect); selects['property'] = propertySelect;

      const dealLabel = document.createElement('label'); dealLabel.textContent = 'ડીલનો પ્રકાર: ';
      const dealSelect = document.createElement('select'); dealSelect.id = 'select-deal'; dealSelect.disabled = true; dealSelect.onchange = filterData;
      filtersContainer.appendChild(dealLabel); filtersContainer.appendChild(dealSelect); selects['deal'] = dealSelect;

      const locationLabel = document.createElement('label'); locationLabel.textContent = 'લોકેશન: ';
      const locationSelect = document.createElement('select'); locationSelect.id = 'select-LOCATION';
      const allLocationOption = document.createElement('option'); allLocationOption.value = 'All'; allLocationOption.textContent = 'બધા'; locationSelect.appendChild(allLocationOption);
      const uniqueLocations = [...new Set(data.map(item => item['LOCATION']).filter(v => v && v.trim() !== ''))].sort();
      uniqueLocations.forEach(value => { const option = document.createElement('option'); option.value = value; option.textContent = value; locationSelect.appendChild(option); });
      locationSelect.onchange = filterData; filtersContainer.appendChild(locationLabel); filtersContainer.appendChild(locationSelect); selects['LOCATION'] = locationSelect;

      const rangeLabel = document.createElement('label'); rangeLabel.textContent = 'બજેટ: ';
      const rangeSelect = document.createElement('select'); rangeSelect.id = 'select-RANGE';
      const allRangeOption = document.createElement('option'); allRangeOption.value = 'All'; allRangeOption.textContent = 'બધા'; rangeSelect.appendChild(allRangeOption);
      const uniqueRanges = [...new Set(data.map(item => item['RANGE']).filter(v => v && v.trim() !== ''))].sort();
      uniqueRanges.forEach(value => { const option = document.createElement('option'); option.value = value; option.textContent = value; rangeSelect.appendChild(option); });
      rangeSelect.onchange = filterData; filtersContainer.appendChild(rangeLabel); filtersContainer.appendChild(rangeSelect); selects['RANGE'] = rangeSelect;
    }

    function updateDealOptions() {
      const propertySelect = selects['property']; const dealSelect = selects['deal']; dealSelect.innerHTML = '';
      const allOption = document.createElement('option'); allOption.value = 'All'; allOption.textContent = 'બધા'; dealSelect.appendChild(allOption);
      const selectedProperty = propertySelect.value;
      if (selectedProperty !== 'All') {
        const uniqueDeals = [...new Set(data.filter(item => item[selectedProperty] && item[selectedProperty].trim() !== '').map(item => item[selectedProperty]))].sort();
        uniqueDeals.forEach(value => { const option = document.createElement('option'); option.value = value; option.textContent = value; dealSelect.appendChild(option); });
        dealSelect.disabled = false;
      } else { dealSelect.disabled = true; }
      filterData();
    }

    function filterData() {
      let filtered = data;
      const propertySelect = selects['property']; const dealSelect = selects['deal']; const locationSelect = selects['LOCATION']; const rangeSelect = selects['RANGE'];
      const selectedProperty = propertySelect.value; const selectedDeal = dealSelect.value; const selectedLocation = locationSelect.value; const selectedRange = rangeSelect.value;
      if (selectedProperty !== 'All') {
        filtered = filtered.filter(item => item[selectedProperty] && item[selectedProperty].trim() !== '');
        if (selectedDeal !== 'All') { filtered = filtered.filter(item => item[selectedProperty] === selectedDeal); }
      }
      if (selectedLocation !== 'All') { filtered = filtered.filter(item => item['LOCATION'] === selectedLocation); }
      if (selectedRange !== 'All') { filtered = filtered.filter(item => item['RANGE'] === selectedRange); }
      displayResults(filtered);
    }

    function displayResults(deals) {
      const result = document.getElementById('result'); result.innerHTML = '';
      if (deals.length === 0) { result.textContent = 'કોઈ ડીલ મળી નહીં'; return; }
      const table = document.createElement('table'); const thead = document.createElement('thead'); const headerRow = document.createElement('tr');
      headers.forEach(header => { const th = document.createElement('th'); th.textContent = header; headerRow.appendChild(th); });
      thead.appendChild(headerRow); table.appendChild(thead);
      const tbody = document.createElement('tbody');
      deals.forEach(deal => {
        const row = document.createElement('tr');
        headers.forEach(header => { const td = document.createElement('td'); td.textContent = deal[header] || 'N/A'; row.appendChild(td); });
        tbody.appendChild(row);
      });
      table.appendChild(tbody); result.appendChild(table);

      const listContainer = document.createElement('div'); listContainer.className = 'deal-list';
      deals.forEach(deal => {
        const card = document.createElement('div'); card.className = 'deal-card';
        headers.forEach(header => { const p = document.createElement('p'); p.innerHTML = `<strong>${header}:</strong> ${deal[header] || 'N/A'}`; card.appendChild(p); });
        listContainer.appendChild(card);
      });
      result.appendChild(listContainer);
    }
  </script>
</body>
</html>
